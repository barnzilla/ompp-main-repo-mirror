

// Extra tests for ompp probing

actor_set Host asAllHostsByPhase[disease_phase] //EN All Hosts by disease phase
filter report_time >= 5;

table Host MyTest
{
    report_time
    * {
        duration(disease_phase, DP_INFECTIOUS) / duration() //EN Proportion infectious decimals=6
    }
};


partition MY_PART
{
    0.5, 2.1
};

classification APPEARANCE //EN Appearance
{
    //EN Looks fine
    A_FINE,

    //EN Looks sick
    A_SICK
};

aggregation APPEARANCE, DISEASE_PHASE
{
	A_FINE, DP_SUSCEPTIBLE,
	A_FINE, DP_LATENT,
	A_SICK, DP_INFECTIOUS,
	A_FINE, DP_IMMUNE
};

actor Host
{
    real hui = (disease_phase == DP_INFECTIOUS) ? 0.8 : 1.0;

    real qaly = weighted_duration(hui);
    real v00 = weighted_duration(disease_phase, DP_IMMUNE, hui);
    real v01 = weighted_cumulation(hui, hui);
    real v02 = active_spell_duration(disease_phase, DP_INFECTIOUS);
    real v03 = completed_spell_duration(disease_phase, DP_INFECTIOUS);
    real v04 = active_spell_weighted_duration(disease_phase, DP_INFECTIOUS, hui);
    real v05 = completed_spell_weighted_duration(disease_phase, DP_INFECTIOUS, hui);
    real v06 = active_spell_delta(disease_phase, DP_INFECTIOUS, age);
    real v07 = completed_spell_delta(disease_phase, DP_INFECTIOUS, age);
    logical v08 = undergone_entrance(disease_phase, DP_INFECTIOUS);
    logical v09 = undergone_exit(disease_phase, DP_INFECTIOUS);
    logical v10 = undergone_transition(disease_phase, DP_INFECTIOUS, DP_IMMUNE);
    logical v11 = undergone_change(disease_phase);
    counter v12 = entrances(disease_phase, DP_INFECTIOUS);
    counter v13 = exits(disease_phase, DP_INFECTIOUS);
    counter v14 = transitions(disease_phase, DP_INFECTIOUS, DP_IMMUNE);
    counter v15 = changes(disease_phase);
    double v16 = value_at_first_entrance(disease_phase, DP_INFECTIOUS, age);
    double v17 = value_at_latest_entrance(disease_phase, DP_INFECTIOUS, age);
    double v18 = value_at_first_exit(disease_phase, DP_INFECTIOUS, age);
    double v19 = value_at_latest_exit(disease_phase, DP_INFECTIOUS, age);
    double v20 = value_at_first_transition(disease_phase, DP_INFECTIOUS, DP_IMMUNE, age);
    double v21 = value_at_latest_transition(disease_phase, DP_INFECTIOUS, DP_IMMUNE, age);
    double v22 = value_at_first_change(disease_phase, age);
    double v23 = value_at_latest_change(disease_phase, age);
    double v24 = value_at_entrances(disease_phase, DP_INFECTIOUS, age);
    double v25 = value_at_exits(disease_phase, DP_INFECTIOUS, age);
    double v26 = value_at_transitions(disease_phase, DP_INFECTIOUS, DP_IMMUNE, age);
    double v27 = value_at_changes(disease_phase, age);
    counter v28 = split(age, MY_PART);
    APPEARANCE v29 = aggregate(disease_phase, APPEARANCE);
    logical v30 = trigger_entrances(disease_phase, DP_INFECTIOUS);
    logical v31 = trigger_exits(disease_phase, DP_INFECTIOUS);
    logical v32 = trigger_transitions(disease_phase, DP_INFECTIOUS, DP_IMMUNE);
    logical v33 = trigger_changes(disease_phase);
    counter v34 = duration_counter(disease_phase, DP_LATENT, 0.083333);
    counter v35 = duration_counter(disease_phase, DP_LATENT, 0.083333, 12);
    logical v36 = duration_trigger(disease_phase, DP_LATENT, 0.5);
    counter v37 = self_scheduling_int(age);
    counter v38 = self_scheduling_split(age, MY_PART);

    logical year_le_5 = (report_time <= 5) ? TRUE : FALSE;

	logical one_time_done = { FALSE };
	event OneTimetime, OneTime;
    double thingee;
};

TIME Host::OneTimetime()
{
	if (one_time_done) return TIME_INFINITE;
	else return 0.0;
}
void Host::OneTime()
{
    thingee = RandNormal(11);
    one_time_done = TRUE;
}

table Host MyTest2
{
    {
        1000000.0 * v00 / duration(), //EN v00
        1000000.0 * v01 / duration(), //EN v01
        1000000.0 * v02 / duration(), //EN v02
        1000000.0 * v03 / duration(), //EN v03
        1000000.0 * v04 / duration(), //EN v04
        1000000.0 * v05 / duration(), //EN v05
        1000000.0 * v06 / duration(), //EN v06
        1000000.0 * v07 / duration(), //EN v07
        1000000.0 * v08 / duration(), //EN v08
        1000000.0 * v09 / duration(), //EN v09
        1000000.0 * v10 / duration(), //EN v10
        1000000.0 * v11 / duration(), //EN v11
        1000000.0 * v12 / duration(), //EN v12
        1000000.0 * v13 / duration(), //EN v13
        1000000.0 * v14 / duration(), //EN v14
        1000000.0 * v15 / duration(), //EN v15
        1000000.0 * v16 / duration(), //EN v16
        1000000.0 * v17 / duration(), //EN v17
        1000000.0 * v18 / duration(), //EN v18
        1000000.0 * v19 / duration(), //EN v19
        1000000.0 * v20 / duration(), //EN v20
        1000000.0 * v21 / duration(), //EN v21
        1000000.0 * v22 / duration(), //EN v22
        1000000.0 * v23 / duration(), //EN v23
        1000000.0 * v24 / duration(), //EN v24
        1000000.0 * v25 / duration(), //EN v25
        1000000.0 * v26 / duration(), //EN v26
        1000000.0 * v27 / duration(), //EN v27
        1000000.0 * v28 / duration(), //EN v28
        1000000.0 * v29 / duration(), //EN v29
        1000000.0 * v30 / duration(), //EN v30
        1000000.0 * v31 / duration(), //EN v31
        1000000.0 * v32 / duration(), //EN v32
        1000000.0 * v33 / duration(), //EN v33
        1000000.0 * v34 / duration(), //EN v34
        1000000.0 * v35 / duration(), //EN v35
        1000000.0 * v36 / duration(), //EN v36
        1000000.0 * v37 / duration(), //EN v37
        1000000.0 * v38 / duration() //EN v38
  }
    * year_le_5
};


table Host MyTest3
{
    {
        value_out(thingee),
        min_value_out(thingee),
        max_value_out(thingee)
    }
};

